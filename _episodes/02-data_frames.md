---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-data_frames.md in _episodes_rmd/
title: "Working with Tabular Data"
teaching: 40
exercises: 20
questions:
  - "How to import tabular data into R?"
  - "What kind of object stores tabular data?"
  - "How to investigate the contents of such object?"
  - "How to deal with  missing data?"
objectives: 
  - "Import tabular data into R using the `read_csv()` function."
  - "Understand the relationship between vectors and data.frames/tibbles and distinguish between them."
  - "Discuss the importance of and apply basic quality control checks of data."
  - "Apply the following functions to examine data: `summary()`, `str()`, `unique()`, `length()`"
  - "Analyse vectors with missing data."
keypoints:
  - "Use `library()` to load a library into R. You need to do this every time you start a new R session."
  - "Read data using the `read_csv()` function, or one of it's other similarly-named functions."
  - "In R tabular data is stored in a `data.frame` object."
  - "Columns in a `data.frame` are _vectors_. Therefore, a `data.frame` is a _list_ of _vectors_ of the same length."
  - "A vector can only contain data of one type (e.g. all numeric, or all character). Therefore, each column of a `data.frame` can only be of one type also (although different columns may be of different types)."
  - 
source: Rmd
---



## Presentation of the Gapminder Dataset

Throughout this course, we will use data from the [_Gapminder Foundation_](https://www.gapminder.org/), 
which gives access to global data as well as many tools to help explore it.
In these lessons we're going to use some of these data to explore some of these data 
ourselves.

We have two datasets with data relating to socio-economic statistics: world data 
for 2010 only and the same data for 1960 to 2010 (see the [setup](setup.html) 
page for instructions on how to download the data).

Here is a description of each column of the dataset:

| Column                       | Description                                                                                                                     |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| country_id                  | gapminder country identifier                                                                                                    |
| country                     | country name                                                                                                                    |
| world_region                | 6 world regions                                                                                                                 |
| economic_organisation       | “OECD”, “G77” or “others”                                                                                                       |
| income_groups               | categorical classification of income groups                                                                                     |
| main_religion               | religion of the majority of population in 2008                                                                                  |
| year                        | year that each variable refers to                                                                                               |
| population_male             | total number of male population                                                                                                 |
| population_female           | total number of female population                                                                                               |
| income_per_person           | gross domestic product per person adjusted for differences in purchasing power                                                  |
| life_expectancy             | average number of years a newborn child would live if current mortality patterns were to stay the same                          |
| life_expectancy_female      | life expectancy at birth, females                                                                                               |
| life_expectancy_male        | life expectancy at birth, males                                                                                                 |
| children_per_woman          | total fertility rate                                                                                                            |
| newborn_mortality           | death of children within the first 28 days per 1000 births                                                                      |
| child_mortality             | death of children under 5 years old per 1000 births                                                                             |
| employment_percent_female   | percentage of female population aged 15+ employed during the given year                                                         |
| employment_percent_male     | percentage of male population aged 15+ employed during the given year                                                           |
| hdi_human_development_index | index used to rank countries by level of “human development” accounting for health level, educational level and living standard |


## Reading Data Into R

There are several functions to read data into R, we're going to use one from the 
`readr` package, which is part of the `tidyverse`. As such, we first need to load 
the package into R's memory, by using the `library()` function:


~~~
library(tidyverse)
~~~
{: .language-r}

This command has to be run every time you start a new R session. Tipycally you 
want to include the `library()` calls at the top of your script, so that a user 
knows which packages need to be installed to run the analysis.

Our data is provided in CSV format (comma separated values). This format is a 
regular text file, where each value (or column of the table) is separated by a 
comma. To read such a file, we use the `read_csv()` function, which needs at least 
one input: the _path_ of the file we want to read. It is also good practice 
to explicitly define how missing data is encoded in the file with the `na` option. 
In our case, missing data are encoded as an empty string (imagine this as an empty 
cell in a spreadsheet).

Here's the command:


~~~
gapminder2010 <- read_csv("data/gapminder2010_socioeconomic.csv", na = "")
~~~
{: .language-r}



~~~
Parsed with column specification:
cols(
  country_id = col_character(),
  country = col_character(),
  world_region = col_character(),
  economic_organisation = col_character(),
  income_groups = col_character(),
  main_religion = col_character(),
  year = col_double(),
  population_male = col_double(),
  population_female = col_double(),
  income_per_person = col_double(),
  life_expectancy = col_double(),
  life_expectancy_female = col_character(),
  life_expectancy_male = col_double(),
  children_per_woman = col_double(),
  newborn_mortality = col_double(),
  child_mortality = col_double(),
  employment_percent_female = col_double(),
  employment_percent_male = col_double(),
  hdi_human_development_index = col_double()
)
~~~
{: .output}

We see a lot of output there, but this is not an error! It's a message that `read_csv()` 
prints to inform us of what type of data it thinks each column of the dataset is. 
We'll discuss this in a while. 

For now, let's investigate what kind of object the `read_csv()` function returns.

> ## Exercise
> 
> Try and answer these questions about `gapminder2010`:
> 
> 1. What type of object is it? (hint: `class()`)
> 2. How many rows and columns does it have? (hint: `ncol()`, `nrow()`)
> 3. What type of values does each column have? (hint: `str()`)
> 4. Inspect the range of values in the numeric columns using `summary()`.
>
> In all these inspections, can you spot any suspicious problems with the data?
>
> > ## Solution
> > 
> > A1. This object has several classes, variants of 'tbl' and 'data.frame':
> > 
> > 
> > ~~~
> > class(gapminder2010)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" 
> > ~~~
> > {: .output}
> > 
> > A2. It has 193 rows and 19 columns
> > 
> > 
> > ~~~
> > nrow(gapminder2010)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] 193
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > ncol(gapminder2010)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] 19
> > ~~~
> > {: .output}
> > 
> > A3. `str()` gives us the _structure_ of the object, which provides information 
> > about each column type as well as the class and dimensions of the data frame:
> > 
> > 
> > ~~~
> > str(gapminder2010)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > Classes 'spec_tbl_df', 'tbl_df', 'tbl' and 'data.frame':	193 obs. of  19 variables:
> >  $ country_id                 : chr  "afg" "ago" "alb" "and" ...
> >  $ country                    : chr  "Afghanistan" "Angola" "Albania" "Andorra" ...
> >  $ world_region               : chr  "south_asia" "sub_saharan_africa" "europe_central_asia" "europe_central_asia" ...
> >  $ economic_organisation      : chr  "g77" "g77" "others" "others" ...
> >  $ income_groups              : chr  "low_income" "upper_middle_income" "upper_middle_income" "high_income" ...
> >  $ main_religion              : chr  "muslim" "christian" "muslim" "christian" ...
> >  $ year                       : num  2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
> >  $ population_male            : num  14797692 11433112 1475395 NA 6161489 ...
> >  $ population_female          : num  14005472 11936012 1465122 NA 2109193 ...
> >  $ income_per_person          : num  1614 5895 9927 38982 57580 ...
> >  $ life_expectancy            : num  56.2 60.1 76.3 82.7 76.5 ...
> >  $ life_expectancy_female     : chr  "62.476" "60.908" "79.209" "-" ...
> >  $ life_expectancy_male       : num  60.1 55.5 74.4 -999 75.7 ...
> >  $ children_per_woman         : num  5.82 6.16 1.65 NA 1.87 2.37 1.55 2.13 1.93 1.44 ...
> >  $ newborn_mortality          : num  38.7 52.6 7.5 1.7 4.3 7.5 9.5 6 2.8 2.5 ...
> >  $ child_mortality            : num  90.2 119.4 16.6 3.3 8.6 ...
> >  $ employment_percent_female  : num  12.9 67.4 39.4 NA 37.9 ...
> >  $ employment_percent_male    : num  80.4 73 53.8 NA 90.8 ...
> >  $ hdi_human_development_index: num  0.454 0.495 0.738 0.819 0.824 0.816 0.729 0.782 0.927 0.88 ...
> >  - attr(*, "spec")=
> >   .. cols(
> >   ..   country_id = col_character(),
> >   ..   country = col_character(),
> >   ..   world_region = col_character(),
> >   ..   economic_organisation = col_character(),
> >   ..   income_groups = col_character(),
> >   ..   main_religion = col_character(),
> >   ..   year = col_double(),
> >   ..   population_male = col_double(),
> >   ..   population_female = col_double(),
> >   ..   income_per_person = col_double(),
> >   ..   life_expectancy = col_double(),
> >   ..   life_expectancy_female = col_character(),
> >   ..   life_expectancy_male = col_double(),
> >   ..   children_per_woman = col_double(),
> >   ..   newborn_mortality = col_double(),
> >   ..   child_mortality = col_double(),
> >   ..   employment_percent_female = col_double(),
> >   ..   employment_percent_male = col_double(),
> >   ..   hdi_human_development_index = col_double()
> >   .. )
> > ~~~
> > {: .output}
> > 
> > A4. The summary function gives us basic summary statistics for each  numeric 
> > column and indicates which columns are of "character" type.
> > 
> > 
> > ~~~
> > summary(gapminder2010)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> >   country_id          country          world_region      
> >  Length:193         Length:193         Length:193        
> >  Class :character   Class :character   Class :character  
> >  Mode  :character   Mode  :character   Mode  :character  
> >                                                          
> >                                                          
> >                                                          
> >                                                          
> >  economic_organisation income_groups      main_religion     
> >  Length:193            Length:193         Length:193        
> >  Class :character      Class :character   Class :character  
> >  Mode  :character      Mode  :character   Mode  :character  
> >                                                             
> >                                                             
> >                                                             
> >                                                             
> >       year      population_male     population_female   income_per_person
> >  Min.   :2010   Min.   :    45367   Min.   :    44262   Min.   :   609   
> >  1st Qu.:2010   1st Qu.:  1346236   1st Qu.:  1192325   1st Qu.:  3279   
> >  Median :2010   Median :  4354216   Median :  4386635   Median :  9916   
> >  Mean   :2010   Mean   : 18961371   Mean   : 18641686   Mean   : 16446   
> >  3rd Qu.:2010   3rd Qu.: 12395772   3rd Qu.: 12488792   3rd Qu.: 21771   
> >  Max.   :2010   Max.   :699882239   Max.   :659872868   Max.   :125141   
> >                 NA's   :9           NA's   :9                            
> >  life_expectancy life_expectancy_female life_expectancy_male
> >  Min.   :32.11   Length:193             Min.   :-999.00     
> >  1st Qu.:63.91   Class :character       1st Qu.:  60.27     
> >  Median :72.56   Mode  :character       Median :  68.25     
> >  Mean   :70.23                          Mean   :  17.69     
> >  3rd Qu.:76.70                          3rd Qu.:  72.94     
> >  Max.   :82.85                          Max.   :  80.06     
> >  NA's   :6                                                  
> >  children_per_woman newborn_mortality child_mortality
> >  Min.   :1.190      Min.   : 0.8      Min.   :  2.6  
> >  1st Qu.:1.810      1st Qu.: 5.0      1st Qu.:  8.7  
> >  Median :2.475      Median :11.7      Median : 20.7  
> >  Mean   :2.995      Mean   :15.6      Mean   : 38.7  
> >  3rd Qu.:4.043      3rd Qu.:24.6      3rd Qu.: 62.2  
> >  Max.   :7.490      Max.   :52.6      Max.   :208.0  
> >  NA's   :9                                           
> >  employment_percent_female employment_percent_male
> >  Min.   : 4.54             Min.   :38.62          
> >  1st Qu.:39.08             1st Qu.:61.55          
> >  Median :46.86             Median :68.78          
> >  Mean   :46.63             Mean   :67.95          
> >  3rd Qu.:56.94             3rd Qu.:75.29          
> >  Max.   :83.62             Max.   :95.65          
> >  NA's   :14                NA's   :14             
> >  hdi_human_development_index
> >  Min.   :0.3230             
> >  1st Qu.:0.5435             
> >  Median :0.7105             
> >  Mean   :0.6773             
> >  3rd Qu.:0.7957             
> >  Max.   :0.9390             
> >  NA's   :7                  
> > ~~~
> > {: .output}
> > 
> > From this inspection, we can see that the columns named `life_expectancy_female` 
> > has been imported as "character", although is should probably be numeric.
> > Also, the minimum value in the `life_expectancy_male` column is -999, which 
> > should not be possible (only positive values should be allowed).
>{: .solution}
{: .challenge}


> ## Reading data: many functions available
> 
> The `readr` package has several functions to read data in different formats. 
> Some common ones are: 
> 
> - `read_csv()` - for comma separated values
> - `read_tsv()` - for tab separated values
> - `read_csv2()` - for CSV files exported from non-english spreadsheet programs
> that use the semi-colon `;` as a separator and a comma `,` as the decimal place. 
> - `read_table()` - to read data where each column is separated by one or more spaces.
> - `read_delim()` - a flexible function that allows you to define your own delimiter. 
> 
> These functions have equivalents in base R (the default installation of R), 
> which you can also use. They are very similarly named, for example:
> `read.csv()` and `read.table()` (notice the `.` instead of `_` in the function name). 
> However, **they have different default options**, so pay attention to which one you use! 
{: .callout}


## The `data.frame` Object

A **data.frame** is the basic type of object that stores _tabular_ data. 
The `readr` package reads data in an "extended" version of a data frame that it 
calls **tibble** (`tbl` for short). The details of their differences are not very 
important unless you are a programmer, but _tibbles_ offer some user conveniences 
such as a better printing method. For the rest of the course we'll refer to 
"data frames" and "tibbles" interchangeably.

A technical point that is worth being aware of is that _a data frame is a list 
of vectors of the same length_. In other words, we can manipulate each column in 
a data frame just as we've learned for vectors in the
[previous episode]({{ page.root }}{% link _episodes/01-objects_functions_vectors.md %})). 

To return the values of a column as a vector, we can use the `$` accessor. 
For example try:


~~~
gapminder2010$country
~~~
{: .language-r}


> ## Exercise
> 
> Using the `$` accessor and some functions that work on vectors, try and answer 
> the following questions:
> 
> 1. What are the distinct values present in the `world_region` column? (hint: `unique()`)
> 2. How many distinct regions are there? (hint: combine `length()` and `unique()`)
> 3. How many countries are there in each of those regions? (hint: `table()`)
> 4. Do this same exploratory analysis on the `main_religion` column and note any 
> problems you may notice. 
> 
> > ## Answer 
> > A1. 
> > 
> > 
> > ~~~
> > unique(gapminder2010$world_region)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "south_asia"               "sub_saharan_africa"      
> > [3] "europe_central_asia"      "middle_east_north_africa"
> > [5] "america"                  "east_asia_pacific"       
> > ~~~
> > {: .output}
> > 
> > A2. We could have "manually" counted the categories from the previous answer, 
> > but to do it programatically, we can do:
> > 
> > 
> > ~~~
> > length(unique(gapminder2010$world_region))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] 6
> > ~~~
> > {: .output}
> > 
> > A3. The table function counts how many of each unique value there is in a vector.
> > 
> > 
> > ~~~
> > table(gapminder2010$world_region)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > 
> >                  america        east_asia_pacific      europe_central_asia 
> >                       35                       30                       52 
> > middle_east_north_africa               south_asia       sub_saharan_africa 
> >                       20                        8                       48 
> > ~~~
> > {: .output}
> > 
> > A4. From looking at the unique values:
> > 
> > 
> > ~~~
> > unique(gapminder2010$main_religion)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "muslim"              "christian"           "Muslim"             
> > [4] NA                    "eastern religions"   "Christian"          
> > [7] "eastern   religions"
> > ~~~
> > {: .output}
> > 
> > We can see that:
> > 
> > - "muslim" and "christian" are sometimes uppercase and other times lowercase
> > - there is a value of "eastern religions" that seems to have extra spaces between 
> >   the two words.
> > - There are some missing values in this column
> > 
> > By tabulating these values we can see the categories with the lowest counts 
> > must be the ones with a mistake in them.
> > 
> > 
> > ~~~
> > table(gapminder2010$main_religion)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > 
> >           christian           Christian eastern   religions 
> >                 107                  12                   1 
> >   eastern religions              muslim              Muslim 
> >                  11                  41                   4 
> > ~~~
> > {: .output}
> {: .solution}
{: .challenge}
<p></p>

Because each column in a data frame is a vector, this also means that columns of 
a data frame can only contain data of one type (e.g. all character or all numeric). 
The consequence of this is that when you read data, the `read_csv()` 
function will try to guess what data type each column is. And if it sees numbers 
mixed with characters it will consider the column to be character (this is the 
_value coercion_ that we've discussed about in the 
[previous episode]({{ page.root }}{% link _episodes/01-objects_functions_vectors.md %})))

We can see this feature affected the values in the `life_expectancy_female` column, 
which are of type "character", when we would expect them to be "numeric":


~~~
class(gapminder2010$life_expectancy_female)
~~~
{: .language-r}



~~~
[1] "character"
~~~
{: .output}

If you print the contents of that column, you will notice that some values are "-", 
which are probably missing values that were encoded with that symbol rather than 
with an empty value. We will learn how to fix this issue in a future episode. 


### Subsetting Rows and Columns with `[, ]`

Similarly to what we've seen in the 
[previous episode]({{ page.root }}{% link _episodes/01-objects_functions_vectors.md %}) 
for _vectors_, we can access values inside a `data.frame` using the square-bracket construct. 
The difference is that now we have two dimensions: _rows_ and _columns_. 
Therefore, the syntax is slightly different, because we have to specificy these two 
dimensions as `[rows, columns]`. 
For example, try running these:


~~~
# access the first row and columns 3 to 6
gapminder2010[1, 3:6]

# access the first 5 rows and all columns
gapminder2010[1:5, ]

# access the first 2 columns and all rows
gapminder2010[ , 1:2]
~~~
{: .language-r}

You can also access columns _by name_, for example:


~~~
gapminder2010[, c("country", "income_per_person")]
~~~
{: .language-r}



> ## Data tip: quality control checks
> 
> Whenever you read data into R, it's always good practice to do some quality 
> checks. Here's a list of things to lookout for:
> 
> - Do you have the expected number of rows and columns?
> - Are your variables (columns) of the expected type? (e.g. numeric, character)
> - Is the range of numeric data within expected boundaries? For example: a column with 
> months should go from 1 to 12; a column with human heights in cm should not 
> have values below 30 or so; etc...
> - Do you have the expected number of unique values in categorical (character) variables?
> - Do you have missing values in the data, and were these imported correctly?
> 
> In R, you can answer many of these questions with the help of the following 
> functions: `str()`, `summary()`, `length()` + `unique()`, `nrow()`, `ncol()`, 
> `is.na()`.
> 
> There are also some R packages that can help making these diagnostic analysis 
> easier. One good one is the `skimr` package (which has a good 
> [`introduction document`](https://cran.r-project.org/web/packages/skimr/vignettes/Using_skimr.html). > If you use the `skim()` function with your `data.frame` it will give you a tabular 
> summary that will help you answer all these questions in one go!
{: .callout}


{% include links.md %}
